<?php

namespace api\modules\v1\controllers;


use common\models\User;
use Yii;
use yii\filters\auth\HttpBasicAuth;
use yii\web\Controller;
use yii\web\NotFoundHttpException;
use yii\filters\VerbFilter;
use yii\rest\ActiveController;

/**
 * @property mixed username
 * @property mixed nome
 * @property mixed dataNascimento
 * @property mixed nacionalidade
 * @property mixed password
 * @property mixed email
 */
class UserController extends ActiveController
{

    public $modelClass = 'common\models\User';

    /*public function actionIndex()
    {
        return $this->render('index');
    }*/

    //Cria outro user controller um sem autenticacao para fazer o login na aplicaÃ§Ã£o android

    /*public function behaviors()
    {
        $behaviors = parent::behaviors();
        $behaviors['authenticator']=[
            'class' => HttpBasicAuth::className(),
            'auth' => function($username, $password)
            {
                $user = User::findByUsername($username);
                if($user && $user->validatePassword($password))
                {
                    return $user;
                }
            }
        ];
        return $behaviors; // TODO: Change the autogenerated stub
    }*/


    public function actionLogin(){
        $user = User::findByUsername(Yii::$app->request->post('username'));
        if($user->validatePassword(Yii::$app->request->post('password'))){
            return $user;
        }
        return [false];
    }

    public function actionRegisto(){
        $user = new User();
        $user->username = $this->username;
        $user->nome = $this->nome;
        $user->dataNascimento = $this->dataNascimento;
        $user->email = $this->email;
        $user->nacionalidade = $this->nacionalidade;
        $user->setPassword($this->password);
        $user->generateAuthKey();

        if($user->validate()){
            $user->save();
            $auth = \Yii::$app->authManager;
            $regularRole = $auth->getRole('regular');
            $auth->assign($regularRole, $user->getId());
        }

        return $user;

    }

}
